# 새로운 할인 정책 적용과 문제점

현재 만든 로직들로 새로운 정책을 어떻게 적용해야 할까? 주문 서비스의 구현체 안에 있는 정액 할인 구현체를 
정률 할인 구현체로 바꾸면 된다.

하지만 이때 문제가 생김.
* 우리는 역할과 구현을 충분히 구현함 -> O
* 다형성 활용, 인터페이스와 구현 객체 분리 -> O
* OCP, DIP 설계원칙을 지킨거 같지만 지키지 않았다...
  * 실제 서비스 로직을 보면 우리는 인터페이스만 선언한게 아니라 new 를 통해 구현체도 생성함 (즉, 인터페이스 뿐만이 아닌 구현체도 의존하고 있다. DIP 위반.)
    * 인터페이스: DiscountPolicy
    * 구현체: FixDiscountPolicy, RateDiscountPolicy
  * 게다가 지금은 기능을 확장하면 서비스로직(클라이언트 코드)에 영향을 준다.-> 확장된 코드로 변경해주어야 한다. (OCP 위반.)

**예상했던 관계도**

<img src="images/expect.png" width="80%" height="80%"/>

인터페이스에 의존하여 처리되고 있다.

**DIP를 위반한 관계도**

<img src="images/dip.png" width="80%" height="80%"/>

현재 주문 서비스 구현체는 인터페이스뿐만이 아닌 구현체까지에게도 의존하고 있다 (FixDiscountPolicy)

**OCP 위반한 관계도**

<img src="images/ocp.png" width="80%" height="80%"/>

정책이 위와 같이 정액 할인에서 정률 할인으로 변경할 경우 주문 서비스의 코드도 변경해주어야 한다.

* 이를 해결하는 방법은 서비스 로직에서 new로 구현체를 생성하지 말아야 함.
* 서비스에서 new 부분을 지우면 되지만 그럼 당연히... NPE 발생
* 그렇기 때문에 외부에서 구현체를 생성해서 주문 서비스에 주입해주면 된다!
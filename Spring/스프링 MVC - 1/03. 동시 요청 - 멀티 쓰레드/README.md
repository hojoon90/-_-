# 동시 요청 - 멀티 쓰레드

요청에 대한 서블릿 호출은 쓰레드가 함.

### 쓰레드
* 애플리케이션 코드를 순차적으로 실행
* 자바 메인 메서드를 처음 실행하면 main 이라는 이름의 쓰레드가 실행 
* 쓰레드 없인 자바 애플리케이션 실행이 불가능
* 한번에 하나의 코드만 수행
* 동시 처리 필요 시 쓰레드 추가 생성

### 동시 처리 시 쓰레드 생성의 장단점
* 장점
  * 동시 요청 처리
  * 리소스 허용때 까지 처리 가능
  * 쓰레드 하나가 지연되어도 다른 쓰레드 정상 동작
* 단점
  * 쓰레드 생성 비용이 비쌈
    * 고객 요청마다 쓰레드 생성 시 응답속도 저하.
  * 컨텍스트 스위칭 비용이 비쌈 (CPU에 처리할 프로세스를 바꾸는 기술)
  * 쓰레드 생성 제한이 없음
    * 요청 증가 시 컴퓨터 리소스를 전부 사용하여 컴퓨터가 다운될 수 있음.

### 쓰레드 풀
* 특징
  * 필요한 쓰레드를 미리 만들어서 풀에 보관
  * 생성 가능한 쓰레드의 최대치 관리. 톰캣은 기본 200개
* 사용
  * 쓰레드 필요 시, 미리 생성한 쓰레드를 꺼내서 사용
  * 사용 종료 시 쓰레드 풀에 쓰레드 반납
  * 최대 쓰레드를 모두 사용중이라면 요청 대기 혹은 거절 설정 가능
* 장점
  * 쓰레드가 미리 생성되어 있으므로 쓰레드 생성/종료 비용 감소. 응답시간 빨라짐
  * 쓰레드의 최대치가 세팅되어 있으므로 요청이 많아져도 기존 요청 안전하게 처리 가능
* 실무 사용 시
  * WAS의 주요 튜닝 포인트는 최대 쓰레드(max thread) 수. 
  * 동시 요청이 많을 경우
    * 너무 낮게 설정 시엔 서버 리소스는 여유롭지만 클라이언트는 응답 지연 
    * 너무 높게 설정 시엔 CPU, 메모리 리소스 임계점 초과로 서버 다운 
  * 장애 발생시엔 클라우드면 서버 증가 후 튜닝. 클라우드가 아니면 바로 튜닝
* 핵심
  * 멀티쓰레드는 WAS가 처리
  * 개발자는 멀티쓰레드 관련 코드를 신경 쓸 필요 없이 싱글 쓰레드 프로그래밍을 하듯이 개발
  * 멀티 쓰레드 환경이므로 싱글톤 객체는 주의해서 사용
# 동시성 문제

프로젝트 진행 중 사용자의 관심 설정 처리와 관련하여 동시성 처리 문제가 발생하였다. 그래서 이왕 하는 김에 동시성 문제가 무엇이며,
해당 문제가 왜 생겼고, 어떻게 처리 했는지 간단하게 기록으로 남겨보려고 한다.

## 동시성 문제?
동시성 문제란, 하나의 데이터에 2개 이상의 스레드가 접근하여 처리하면서 발생하는 문제이다. 이런 문제는 DB에서 데이터 처리시 많이 발생한다.
예를 들어 한 사람이 데이터를 수정후 저장하였는데, 막상 조회하니 다른 결과가 나오는 경우이다. 가장 와닿는 예시는 아마도 결제관련 예시일 것이다.\
재고가 딱 1개 남은 어떤 물건을 사려고 결제창에서 결제를 할 때, 결제가 정상 처리 된 후 구매 내역을 봤더니 구매한 물건이 없는.. 즉 돈은
돈대로 나가고 물건은 받지 못하는 상황이 발생한다. 이런 문제를 예방하기 위해선 동시성 문제를 항상 고민해주어야 한다.

## 프로젝트에 동시성 문제가 생긴 이유
먼저 현재 진행중인 프로젝트는 관심 설정에 대해 아래와 같은 조건을 전제로 한다.
* 사용자가 여러 기기에서 같은 아이디로 서비스를 이용할 수 있다. 
* DB 테이블에 관심 데이터는 한 사용자당 동일한 데이터가 2개이상 쌓이면 안된다.
  * 없으면 insert, 있으면 관심여부 값만 update 해준다.

여기서 문제 된 부분은 같은 아이디를 여러 기기에서 사용할 수 있다는 것이 문제였다. 기기 아이디가 고유 값이 되다 보니 사용자 아이디를 여러 기기에서 사용할 수 있었고,
서로 다른 기기에서 같은 사용자 아이디로 동시에 관심 설정을 할 경우 한 사용자당 동일한 관심데이터가 2개가 적재되어 버렸다. 동시성 처리가 되지 않은 것이다.
